# 1 MyISAM与InnoDB的区别

| **对比项** | **MyISAM**                                                   | **InnoDB**                                                   |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **外键**   | **不支持**                                                   | **支持**                                                     |
| **事务**   | **不支持**                                                   | **支持**                                                     |
| **行表锁** | **表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作** | **行锁,操作时只锁某一行，不对其它行有影响，****适合高并发的操作** |
| **缓存**   | **只缓存索引，不缓存真实数据**                               | **不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响** |

由于MyISAM使用表锁，在高并发下会出现严重的锁问题，大量的高并发Mysql应用开始使用InnoDB引擎代替MyISAM。

## 1.1 外键和主键

### 什么是主键，外键

关系型数据库中一条记录中有若干属性，某一个属性组(注意是组)能唯一标识一条记录，该属性组就可以成为一个主键 
比如  
学生表(学号，姓名，性别，班级) 
其中每个学生的学号是唯一的，学号就是一个主键 
课程表(课程编号,课程名,学分) 
其中课程编号是唯一的,课程编号就是一个主键 
成绩表(学号,课程号,成绩) 
成绩表中单一一个属性无法唯一标识一条记录，学号和课程号的组合才可以唯一标识一条记录，所以 学号和课程号的属性组是一个主键 

成绩表中的学号不是成绩表的主键，**但它和学生表中的学号相对应，并且学生表中的学号是学生表的主键，则称成绩表中的学号是学生表的外键** 

同理 成绩表中的课程号是课程表的外键 

定义主键和外键主要是为了维护关系数据库的完整性，总结一下：
1.主键是能确定一条记录的唯一标识，比如，一条记录包括身份正号，姓名，年龄。

身份证号是唯一能确定你这个人的，其他都可能有重复，所以，身份证号是主键。 
2.外键用于与另一张表的关联。是能确定另一张表记录的字段，用于保持数据的一致性。

### 主键，外键和索引的区别 

主键、外键和索引的区别？

|        | 主键                                       | 外键                                                 | 索引                               |
| ------ | ------------------------------------------ | ---------------------------------------------------- | ---------------------------------- |
| 定义： | 唯一标识一条记录，不能有重复的，不允许为空 | 表的外键是另一表的主键, 外键可以有重复的, 可以是空值 | 该字段没有重复值，但可以有一个空值 |
| 作用： | 用来保证数据完整性                         | 用来和其他表建立联系用的                             | 是提高查询排序的速度               |
| 个数： | 主键只能有一个                             | 一个表可以有多个外键                                 | 一个表可以有多个惟一索引           |

聚集索引和非聚集索引的区别？

聚集索引一定是唯一索引。但唯一索引不一定是聚集索引。  

聚集索引，在索引页里直接存放数据，而非聚集索引在索引页里存放的是索引，这些索引指向专门的数据页的数据。

### 常见的数据库主键选取方式有

· 自动增长字段

· 手动增长字段

· UniqueIdentifier

· “COMB（Combine）”类型

# 2 索引优化

## mysql的查询流程

mysql客户端通过协议与mysql服务器建立连接，发送查询语句，先查缓存，如命中，直接返回，否则语句解析，有预处理，比如检查语句正确，然后查询优化（是否使用索引扫描，如果是不可能条件，提前终止）

生成查询计划，然后查询引擎启动，开始执行查询，从底层存储引擎调用API获取数据，最后返回给客户端。

## 存储引擎

　　mysql通过存储引擎取数据，自然跟存储引擎有很大关系，不同的存储引擎索引也不一样，如MyISAM的全文索引，即便索引叫一个名字内部组织方式也不尽相同，最常用的当然就是InnoDB了（还有完全兼容mysql的MariaDB，它的默引擎是XtraDB，跟InnoDB很像），这里写的是**InnoDB引擎**。

而索引的实现也跟存储引擎，按照实现方式分

InnoDB的索引目前只有两种：BTREE索引和HASH索引。

通常我们说的索引不出意外指的就是B树索引，InnoDB的BTREE索引，实际是用B+树实现的，因为在查看表索引时，mysql一律打印BTREE，所以简称为B树索引。

使用了BTREE索引，意味着所有的索引是按顺序排列存储的（升序）

https://www.processon.com/diagraming/60e58cf25653bb46e9113a7d

结构中，每一层节点均从左往右从小到大排列，key1 < key2 < ... <  keyN，对于小于key1或在[key1，key2)或其他的值的节点，在进入叶子节点查找，是一个范围分布

同时，同一层节点之间可直接访问，因为他们之间有指针指向联系（MyISAM的BTREE索引没有）。每次搜索是一个区间搜索，有的话就找到了，没有的话就是空。索引能加快访问速度，因为有了它无需全表扫描数据（不总是这样），根据查找的值，跟节点中的值比较，通常使用二分查找，对于排好序的数值来说，平均速度几乎是最快的。

**val指向了哪里，对于InnoDB，它指向的就是表数据**，因为InnoDB的表数据本身就是索引文件，这是与MyISAM索引的**显著区别**，MyISAM的索引指向的是表数据的地址（val指向的是类似于0x7DFF..之类）。

**数据结构：B+Tree**

一般来说能够达到range就可以算是优化了 idx name_deptId

## BTREE索引的使用口诀（两个法则加6中索引失效的情况）

全值匹配我最爱，最左前缀要遵守；

带头大哥不能死，中间兄弟不能断；

索引列上少计算，范围之后全失效；

LIKE百分写最右，覆盖索引不写*；

不等空值还有OR，索引影响要注意；

VAR引号不可丢，SQL优化有诀窍。

## b-tree和b+tree的区别

1) B-树的关键字、索引和记录是放在一起的， B+树的非叶子节点中只有关键字和指向下一个节点的索引，记录只放在叶子节点中。

2) 在B-树中，越靠近根节点的记录查找时间越快，只要找到关键字即可确定记录的存在；而B+树中每个记录的查找时间基本是一样的，都需要从根节点走到叶子节点，而且在叶子节点中还要再比较关键字。

# 设置简单密码

```mysql
set global validate_password_policy=0;  
set global validate_password_mixed_case_count=0;  
set global validate_password_number_count=3;   
set global validate_password_special_char_count=0;  
set global validate_password_length=3;  
```

# 主从复制，读写分离