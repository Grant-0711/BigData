# Hbase概述

hbase是分布式.存储海量数据的NOsql数据库

## 什么是Nosql数据库

NoSQL(NoSQL = Not Only SQL )，意即"不仅仅是SQL"。

网络产生庞大的数据量，有很大一部分是由关系数据库管理系统（RDBMS）来处理。  

关系模型是非常适合于客户服务器编程，远远超出预期的利益，今天它是结构化数据存储在网络和商务应用的主导技术。 

NoSQL的拥护者们提倡运用非关系型的数据存储

### 关系型数据库遵循ACID规则

事务在英文中是transaction，和现实世界中的交易很类似，它有如下四个特性：

 

**1、A (Atomicity) 原子性**

 原子性很容易理解，也就是说事务里的所有操作要么全部做完，要么都不做，事务成功的条件是事务里的所有操作都成功，只要有一个操作失败，整个事务就失败，需要回滚。

 

比如银行转账，从A账户转100元至B账户，分为两个步骤：1）从A账户取100元；2）存入100元至B账户。这两步要么一起完成，要么一起不完成，如果只完成第一步，第二步失败，钱会莫名其妙少了100元。

  

**2、C (Consistency) 一致性**

 一致性也比较容易理解，也就是说数据库要一直处于一致的状态，事务的运行不会改变数据库原本的一致性约束。

 

例如现有完整性约束a+b=10，如果一个事务改变了a，那么必须得改变b，使得事务结束后依然满足a+b=10，否则事务失败。

**3、I (Isolation) 独立性**

 所谓的独立性是指并发的事务之间不会互相影响，如果一个事务要访问的数据正在被另外一个事务修改，只要另外一个事务未提交，它所访问的数据就不受未提交事务的影响。

 比如现在有个交易是从A账户转100元至B账户，在这个交易还未完成的情况下，如果此时B查询自己的账户，是看不到新增加的100元的。

**4、D (Durability) 持久性**

 持久性是指一旦事务提交后，它所做的修改将会永久的保存在数据库上，即使出现宕机也不会丢失



NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。

### RDBMS vs NoSQL

**RDBMS** 

高度组织化结构化数据 

结构化查询语言（SQL） (SQL) 

数据和关系都存储在单独的表中

数据操纵语言，数据定义语言

严格的一致性

基础事务



**NoSQL** 

代表着不仅仅是SQL

没有声明性查询语言

没有预定义的模式

键 - 值对存储，列存储，文档存储，图形数据库

最终一致性，而非ACID属性

非结构化和不可预知的数据

CAP定理 

高性能和可伸缩性

###  CAP定理（CAP theorem）

在计算机科学中, CAP定理（CAP theorem）, 又被称作 布鲁尔定理（Brewer's theorem）, 它指出对于一个分布式计算系统来说，不可能同时满足以下三点:

- **一致性(Consistency)** (所有节点在同一时间具有相同的数据)
- **可用性(Availability)** (保证每个请求不管成功或者失败都有响应)
- **分隔容忍(Partition tolerance)** (系统中任意信息的丢失或失败不会影响系统的继续运作)

CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，最多只能同时较好的满足两个。

因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三 大类：

- CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。
- CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。
- AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。

### NoSQL的优点/缺点

优点:

-  \- 高可扩展性
- \- 分布式计算
- \- 低成本
- \- 架构的灵活性，半结构化数据
- \- 没有复杂的关系 

缺点:

- \- 没有标准化
- \- 有限的查询功能（到目前为止）
- \- 最终一致是不直观的程序

# 几种主流NoSQL数据库的比较

## HBase

HBase 是 Apache Hadoop 子项目（Java）

HBase 依托于 Hadoop 的 HDFS作为最基本存储基础单。

HBase在列上实现了 BigTable 论文提到的压缩算法、内存操作和布隆过滤器。HBase的表能够作为MR 任务的输入和输出，可以通过Java API来访问数据，也可以通过REST、Avro或者Thrift的API来访问。

### **1. 特点**

#### **1.1 数据格式**

HBash 的数据存储是**基于列*（ColumnFamily）*的**

HBase 允许表下某行某列值为空时不做任何存储*（也不占位）*，减少了空间占用也提高了读性能

不过鉴于其它NoSql数据库也具有同样灵活的数据存储结构，该优势在本次选型中并不出彩。

#### 1.2 性能

HStore存储是HBase存储的核心，它由两部分组成，一部分是MemStore，一部分是StoreFiles。

MemStore 是 Sorted Memory  Buffer，用户写入的数据首先会放入MemStore

MemStore满了以后会Flush成一个StoreFile（底层实现是HFile）

当StoreFile文件数量增长到一定阈值，会触发Compact合并操作，将多个StoreFiles合并成一个StoreFile，合并过程中会进行版本合并和数据删除

**因此可以看出HBase其实只有增加数据**

所有的更新和删除操作都是在后续的compact过程中进行的，这使得用户的写操作只要进入内存中就可以立即返回，保证了HBase  I/O的高性能。

#### **1.3 数据版本**

Hbase 还能直接检索到往昔版本的数据，这意味着我们更新数据时，旧数据并没有即时被清除，而是保留着：

Hbase 中通过 row+columns 所指定的一个存贮单元称为cell。每个 cell都保存着同一份数据的多个版本——版本通过时间戳来索引。

时间戳的类型是 64位整型。时间戳可以由Hbase*(在数据写入时自动 )*赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳。每个 cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。

为了避免数据存在过多版本造成的的管理 *(包括存贮和索引)*负担，Hbase提供了两种数据版本回收方式。一是保存数据的最后n个版本，二是保存最近一段时间内的版本*(比如最近七天)*。用户可以针对每个列族进行设置。

#### 1.4 CAP类别

​	属于CP类型

### **2. Node下的使用**

HBase的相关操作可参考下表：

| 名称                       | 操作                                              |
| :------------------------- | ------------------------------------------------- |
| 创建表                     | create  ‘表名称’，‘列名称1’, ‘列名称2’，‘列名称n’ |
| 添加记录                   | put  ‘表名称’，‘行名称’，   ‘列名称1’，‘值’       |
| 查看记录                   | get  ‘表名称’，‘行名称’                           |
| 查看记录总数               | count ‘表名称’                                    |
| 删除记录                   | delete  ‘表名称’，‘行名称’,‘列名称’               |
| 删除一张表                 | 先disable ‘表名称’ 再delete  ‘表名称’             |
| 查看所有记录               | scan ‘表名称’                                     |
| 查看某个表中某个列所有数据 | scan ‘表名称’，【‘列名称’】                       |
| 更新记录                   | 重写一边进行覆盖                                  |

### **3. 优缺点**

**优势**

1. 存储容量大，一个表可以容纳上亿行，上百万列；

2. 可通过版本进行检索，能搜到所需的历史版本数据；

3. 负载高时，可通过简单的添加机器来实现水平切分扩展，跟Hadoop的无缝集成保障了其数据可靠性*（HDFS）*和海量数据分析的高性能*（MapReduce）*；

4. 在第3点的基础上可有效避免单点故障的发生。

 

**缺点**

1. 基于Java语言实现及Hadoop架构意味着其API更适用于Java项目；

2. node开发环境下所需依赖项较多、配置麻烦*（或不知如何配置，如持久化配置）*，缺乏文档；

3. 占用内存很大，且鉴于建立在为批量分析而优化的HDFS上，导致读取性能不高；

4. API相比其它 NoSql 的相对笨拙。

 

**适用场景**

1. bigtable类型的数据存储；

2. 对数据有版本查询需求；

3. 应对超大数据量要求扩展简单的需求。

## Redis

## MongoDB

## Couchbase

## LevelDB